<hois-collapsable ng-repeat="module in higherResults.modules" expanded="false">
  <!-- if there is no extra curriculum subjects module(KORGMOODUL_V) then module.id is set to -1 -->
  <hois-collapsable-header ng-if="module.id > -1">
    <div layout="row">
      <div flex="30">
        <span>{{currentLanguageNameField(module)}} {{module.totalCredits}} EAP</span>
        <span ng-if="module.type !== 'KORGMOODUL_M'">(<hois-classifier-value class="inline" ng-model="module.type" main-classifier-code="KORGMOODUL"></hois-classifier-value>)</span>
        <span ng-if="module.type === 'KORGMOODUL_M'">({{currentLanguage()=='et' ? module.typeNameEt : module.typeNameEn}})</span>
      </div>
      <b ng-if="!module.isOk" flex-offset="10" md-colors="{color: 'accent'}">&nbsp;{{ module.totalDifference }}</b>
      <i class="material-icons" flex-offset="10" md-colors="{color: 'green-600'}" ng-if="module.isOk">done</i>
    </div>
  </hois-collapsable-header>
  <hois-collapsable-header ng-if="module.id === -1">
      <div layout="row">
        <div flex="30">
          <hois-classifier-value class="inline" ng-model="module.type" main-classifier-code="KORGMOODUL"></hois-classifier-value>
        </div>
        <i class="material-icons" flex-offset="10" md-colors="{color: 'green-600'}" ng-if="module.isOk">done</i>
      </div>
  </hois-collapsable-header>
  <md-table-container>
    <table md-table>
      <tbody md-body>
        <tr md-row ng-if="hasMandatorySubjects(module)">
          <td colspan="7" class="sub-header1">
            &nbsp;{{'subject.mandatory' | translate}}
            <i class="material-icons green" ng-if="module.mandatoryDifference >= 0">done</i>
          </td>
        </tr>
        <tr md-row class="secondary-table-header" ng-if="hasMandatorySubjects(module)">
          <td md-cell>{{'student.result.higher.subject' | translate}}</td>
          <td md-cell>{{'student.result.higher.subjectCode' | translate}}</td>
          <td md-cell>{{'student.result.higher.credits' | translate}}</td>
          <td md-cell>{{'student.result.higher.grade' | translate}}</td>
          <td md-cell>{{'student.result.higher.date' | translate}}</td>
          <td md-cell>{{'student.result.higher.teacher' | translate}}</td>
          <td md-cell>{{'student.result.isOk' | translate}}</td>
        </tr>
        <tr md-row ng-repeat-start="subjectResult in higherResults.subjectResults | filter: filterSubjectResultsByModule(module) 
          | filter: {isOptional: false} | orderBy: 'subject.' + currentLanguageNameVariable()">
          <td md-cell>
            <span ng-if="subjectResult.isApelTransfer" class="apelAsterisk">*</span>
            <span>{{currentLanguageNameField(subjectResult.subject)}}</span>
            <span ng-if="!subjectResult.isFormalLearning && subjectResult.isApelTransfer"> - {{'student.result.informal' | translate}}</span>
          </td>
          <td md-cell>{{subjectResult.subject.code}}</td>
          <td md-cell>{{subjectResult.subject.credits}}</td>
          <td md-cell>
            <table>
              <tr class="one-row">
                <td ng-repeat="grade in subjectResult.grades | orderBy: ['isActive', 'gradeDate']">
                  <span ng-if="$index !== 0">/</span>
                  <span ng-class="{badResult: !gradeUtil.isPositive(grade.grade)}">{{grade.gradeValue}}</span>
                </td>
              </tr>
            </table>
          </td>
          <td md-cell>{{subjectResult.lastGrade.gradeDate | hoisDate}}</td>
          <td md-cell>
            <table>
              <tr ng-repeat="teacher in subjectResult.lastGrade.teachers | orderBy">
                <td>{{teacher}}</td>
              </tr>
            </table>
          </td>
          <td md-cell>{{subjectResult.isOk ? 'main.yes' : 'main.no' | translate}}</td>
        </tr>
        <tr md-row ng-repeat="replacedSubject in subjectResult.replacedSubjects | orderBy: currentLanguageNameField(subject)" ng-repeat-end
          class="replaced-subject-row">
          <td md-cell>{{currentLanguageNameField(replacedSubject.subject)}}</td>
          <td md-cell>{{replacedSubject.subject.code}}</td>
          <td md-cell>{{replacedSubject.subject.credits}}</td>
          <td md-cell colspan="4"></td>
        </tr>
        <tr md-row class="secondary-table-header" ng-if="hasMandatorySubjects(module)">
          <td colspan="2">{{'student.result.totalRequired' | translate}}: {{module.compulsoryStudyCredits}}</td>
          <td colspan="2">{{'student.result.totalSubmitted' | translate}}: {{module.mandatoryCreditsSubmitted}}</td>
          <td colspan="3">
            {{'student.result.difference' | translate}}:
            <span ng-class="{'red': module.mandatoryDifference < 0}">{{module.mandatoryDifference}}</span>
          </td>
        </tr>
        <tr md-row ng-if="hasOptionalSubjects(module)">
          <td colspan="7" class="sub-header1">
            {{'subject.optional' | translate}}
            <i class="material-icons green" ng-if="module.optionalDifference >= 0">done</i>
          </td>
        </tr>
        <tr md-row class="secondary-table-header" ng-if="hasOptionalSubjects(module)">
          <td md-cell>{{'student.result.higher.subject' | translate}}</td>
          <td md-cell>{{'student.result.higher.subjectCode' | translate}}</td>
          <td md-cell>{{'student.result.higher.credits' | translate}}</td>
          <td md-cell>{{'student.result.higher.grade' | translate}}</td>
          <td md-cell>{{'student.result.higher.date' | translate}}</td>
          <td md-cell>{{'student.result.higher.teacher' | translate}}</td>
          <td md-cell>{{'student.result.isOk' | translate}}</td>
        </tr>
        <tr md-row ng-repeat-start="subjectResult in higherResults.subjectResults
          | filter: filterSubjectResultsByModule(module) | filter: {isOptional: true} | filter: {electiveModule: '!'}
          | orderBy: 'subject.' + currentLanguageNameVariable()">
          <td md-cell>
            <span ng-if="subjectResult.isApelTransfer" class="apelAsterisk">*</span>
            <span>{{currentLanguageNameField(subjectResult.subject)}}</span>
            <span ng-if="!subjectResult.isFormalLearning && subjectResult.isApelTransfer"> - {{'student.result.informal' | translate}}</span>
          </td>
          <td md-cell>{{subjectResult.subject.code}}</td>
          <td md-cell>{{subjectResult.subject.credits}}</td>
          <td md-cell>
            <table>
              <tr>
                <td ng-repeat="grade in subjectResult.grades | orderBy: ['isActive', 'gradeDate']">
                  <span ng-if="$index !== 0">/</span>
                  <span ng-class="{badResult: !gradeUtil.isPositive(grade.grade)}">{{grade.gradeValue}}</span>
                </td>
              </tr>
            </table>
          </td>
          <td md-cell>{{subjectResult.lastGrade.gradeDate | hoisDate}}</td>
          <td md-cell>
            <table>
              <tr ng-repeat="teacher in subjectResult.lastGrade.teachers | orderBy">
                <td>{{teacher}}</td>
              </tr>
            </table>
          </td>
          <td md-cell>{{subjectResult.isOk ? 'main.yes' : 'main.no' | translate}}</td>
        </tr>
        <tr md-row ng-repeat="replacedSubject in subjectResult.replacedSubjects | orderBy: currentLanguageNameField(subject)" ng-repeat-end
          class="replaced-subject-row">
          <td md-cell>{{currentLanguageNameField(replacedSubject.subject)}}</td>
          <td md-cell>{{replacedSubject.subject.code}}</td>
          <td md-cell>{{replacedSubject.subject.credits}}</td>
          <td md-cell colspan="4"></td>
        </tr>
        <tr md-row ng-if="module.electiveModulesResults.length > 0">
          <td colspan="1" class="sub-header2">
            {{'student.result.higher.electiveModules' | translate}}
            <i class="material-icons green" ng-if="module.electiveModulesNumber <= module.electiveModulesCompleted">done</i>
          </td>
          <td colspan="2" class="sub-header2">{{'student.result.higher.electiveModulesRequired' | translate}}: {{module.electiveModulesNumber}}</td>
          <td colspan="4" class="sub-header2">{{'student.result.higher.electiveModulesCompleted' | translate}}: {{module.electiveModulesCompleted}}</td>
        </tr>
        <tr md-row ng-repeat-start="electiveModule in module.electiveModulesResults | orderBy: currentLanguageNameField()">
          <td md-cell colspan="7" class="sub-header2">
            {{'module.optional' | translate}}: {{currentLanguageNameField(electiveModule)}}
            <i class="material-icons green" ng-if="electiveModule.isOk">done</i>
          </td>
        </tr>

        <tr md-row ng-repeat="subjectResult in higherResults.subjectResults | filter: filterSubjectResultsByModule(module) | filter: {isOptional: true} |
                                filter: {electiveModule: electiveModule.referenceNumber} | orderBy: 'subject.' + currentLanguageNameVariable()">
          <td md-cell>{{currentLanguageNameField(subjectResult.subject)}}</td>
          <td md-cell>{{subjectResult.subject.code}}</td>
          <td md-cell>{{subjectResult.subject.credits}}</td>
          <td md-cell>
            <table>
              <tr>
                <td ng-repeat="grade in subjectResult.grades | orderBy: ['isActive', 'gradeDate']">
                  <span ng-if="$index !== 0">/</span>
                  <span ng-class="{badResult: !gradeUtil.isPositive(grade.grade)}">{{grade.gradeValue}}</span>
                </td>
              </tr>
            </table>
          </td>
          <td md-cell>{{subjectResult.lastGrade.gradeDate | hoisDate}}</td>
          <td md-cell>
            <table>
              <tr ng-repeat="teacher in subjectResult.lastGrade.teachers | orderBy">
                <td>{{teacher}}</td>
              </tr>
            </table>
          </td>
          <td md-cell>{{subjectResult.isOk ? 'main.yes' : 'main.no' | translate}}</td>
        </tr>
        <tr ng-repeat-end></tr>
        <tr md-row class="secondary-table-header" ng-if="hasOptionalSubjects(module)">
          <td colspan="2">{{'student.result.totalRequired' | translate}}: {{module.optionalStudyCredits}}</td>
          <td colspan="2">{{'student.result.totalSubmitted' | translate}}: {{module.optionalCreditsSubmitted}}</td>
          <td colspan="3">
            {{'student.result.difference' | translate}}:
            <span ng-class="{'red': optionalDifference < 0}">{{module.optionalDifference}}</span>
          </td>
        </tr>
      </tbody>
    </table>
  </md-table-container>
</hois-collapsable>

<style>
  .inline {
    display: inline;
  }

  .red {
    color: red;
  }

</style>
