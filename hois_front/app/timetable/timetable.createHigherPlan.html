<div class="ois-form-layout-padding" layout="column" ng-cloak>
  <!--table md-table>
  <thead md-head>
  <tr md-row>
    <th md-column>{{'timetable.timetablePlan.createTimetable' | translate}}</th>
  </tr>
  </thead>
</table-->
  <div layout-padding id="groupSelection">
    <div layout="row" class="form-readonly">
      <md-input-container flex>
        <label class="textInput">{{'timetable.timetablePlan.createTimetable' | translate}}</label>
        <hois-value value="(plan.startDate | hoisDate) + '-'+(plan.endDate | hoisDate)" />
      </md-input-container>
    </div>
    <div flex="60" flex-sm="100" flex-xs="100" layout="row" layout-padding>
      <md-input-container layout="row" layout-align="start center" flex="60">
        <md-radio-group name="lesson-choice" ng-model="plan.byLessons" required layout="row">
          <md-radio-button ng-value="true">{{ 'timetable.timetablePlan.byLesson' | translate }}</md-radio-button>
          <md-radio-button ng-value="false">{{ 'timetable.timetablePlan.byTime' | translate }}</md-radio-button>
        </md-radio-group>
      </md-input-container>
    </div>
    <!--label>{{'timetable.timetablePlan.timetablePeriod' | translate}} {{plan.startDate | hoisDate}} -
    {{plan.endDate | hoisDate}}</label-->
    <div flex>
      <fieldset tabindex="1">
        <legend md-colors="{color: 'primary-800'}" class="md-title-small">{{'timetable.timetablePlan.showGroups' | translate}}</legend>
        <div layout="column">
          <md-checkbox ng-model="plan.selectAll" flex-offset="5">
            {{'timetable.timetablePlan.selectAll' | translate}}
          </md-checkbox>
          <md-grid-list ng-app="app" md-cols="5" md-gutter="1em" md-row-height="36px" flex>
            <md-grid-tile ng-repeat="group in plan.studentGroups">
              <md-checkbox ng-model="group._selected" ng-change="updateGroups()">
                {{group.code}} </md-checkbox>
            </md-grid-tile>
            <md-grid-tile ng-repeat="pair in plan.subjectTeacherPairs"> <span>
            <md-checkbox ng-model="pair._selected" ng-change="updatePairs()">
            {{pair.code}} - {{pair.teacherNamesShort}} </md-checkbox>
            </span></md-grid-tile>
          </md-grid-list>

        </div>
      </fieldset>
    </div>

    <div layout="row">
      <md-input-container flex="30">
        <label>{{'timetable.timetablePlan.planGroupLessons' | translate}}</label>
        <hois-select ng-model="plan.selectedGroup" values="plan.currentStudentGroups" show-property="code" value-property="id"></hois-select>
      </md-input-container>


      <md-input-container flex="10" flex-offset="5">
        <label layout-padding>{{'timetable.timetablePlan.lessonAmount' | translate}}</label>
        <input ng-model="plan.lessonAmount" type="text" autofocus aria-label="lessonamount">
      </md-input-container>

      <md-input-container flex="50" flex-offset="5">
        <label layout-padding>{{'timetable.timetablePlan.repetition' | translate}}</label>
        <hois-classifier-select ng-model="plan.repeatCode" model-value-attr="code" aria-label="repeatcode" main-classifier-code="TUNNIPLAAN_SYNDMUS_KORDUS"></hois-classifier-select>
      </md-input-container>
    </div>

    <div ng-if="plan.repeatCode && plan.lessonAmount">
      <fieldset tabindex="1">
        <legend md-colors="{color: 'primary-800'}" class="md-title-small">{{'timetable.timetablePlan.plannedLessons' | translate}}</legend>
        <table md-table class="secondary-table">
          <thead md-head>
            <tr md-row>
              <th md-column ng-repeat="capacity in plan.currentCapacitiesGrouped">
                {{capacity[0].subjectCode}}
              </th>
            </tr>
          </thead>
          <tbody md-body>
            <tr md-row ng-class-odd="'odd'" ng-class-even="'even'" id="timetable-planned">
              <td md-cell ng-repeat="capacity in plan.currentCapacitiesGrouped track by $index" id="timetable-planned-column">
                <div ng-repeat="current in capacity" style="background-color: {{getColorByCode(current.subjectCode)}}" id="{{current.studentGroup}}"
                  journal-id="{{current.subjectStudyPeriod}}" ois-drag capacity-type="{{current.capacityType}}" class="timetable-drag timetable-planned-capacity">
                  <span>{{current.subjectCode}}/{{getCapacityTypeValue(current.capacityType)}}(</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </fieldset>
    </div>

    <div layout="row" layout-padding>
      <md-input-container flex="30" flex-sm="100" flex-xs="100">
        <label>{{'timetable.timetablePlan.week' | translate}}</label>
        <hois-select ng-model="plan.selectedWeek" values="plan.weeks" show-property="start" value-property="start"></hois-select>
      </md-input-container>
    </div>
  </div>

  <div id="timetableCreation" ng-if="plan.currentStudentGroups.length > 0">
    <md-table-container>
      <table md-table>
        <thead md-head>
          <tr md-row>
            <th md-column></th>
            <th md-column ng-if="plan.byLessons" ng-repeat="date in plan.datesForTimetable" colspan="{{lessonsInDay[weekday[date.getDay()]].length}}">{{'timetable.timetablePlan.' + weekday[date.getDay()] | translate}}
            </th>
            <th md-column ng-if="!plan.byLessons" ng-repeat="date in plan.datesForTimetable" colspan="{{lessonsInDay}}">
              {{'timetable.timetablePlan.' + weekday[date.getDay()] | translate}}
            </th>
          </tr>
        </thead>
        <tbody md-body>
          <tr md-row ng-class-odd="'odd'" ng-class-even="'even'">
            <td></td>
            <td ng-repeat="lessonTime in currentLessonTimes" ng-if="$even" colspan="2" class="timetable-higher-drop-column">
              <span> {{lessonTime | hoisTimeMin}} </span>
            </td>
          </tr>
          <tr md-row ng-repeat="group in plan.currentStudentGroups" ng-class-odd="'odd'" ng-class-even="'even'">
            <td>{{group.code}}</td>
            <td ng-if="plan.byLessons" ng-repeat="lessonTime in currentLessonTimes track by $index">
              <div ng-attr-ois-drop="{{plan.selectedGroup === group.id}}" index-value="{{$index}}" drop-fn="saveEvent(data)" id="{{group.id + '-' + $index}}"
                class="timetable-drop">
                <div ng-click="changeEvent(currentEvent)" ng-if="currentEvent = getEventForLesson($index, lessonTime, group)" ois-drag id="{{currentEvent.journalObject.id + '-' + $index + group.id}}"
                  journal-id="{{currentEvent.journal}}" class="timetable-drag" style="background-color:{{currentEvent.journalObject.color}}"
                  old-event-id="{{currentEvent.id}}">
                  <span>{{currentEvent.journalObject.name.substr(0, 4)}}/{{getCapacityTypeValue(currentEvent.capacityType)}}</span>
                  <br><span style="{{currentEvent.rooms ? '' : 'color:red;font-weight: bold;'}}">{{currentEvent.rooms ? getRoomCodes(currentEvent.rooms) : "?"}}</span>
                </div>
              </div>
            </td>
            <td ng-if="!plan.byLessons" ng-repeat="lessonTime in group.currentLessons" colspan="{{lessonTime.colspan}}">
              <div ng-attr-ois-drop="{{plan.selectedGroup === group.id}}" class="timetable-higher-drop" drop-fn="saveEvent(data)">
                <div ng-click="changeEvent(lessonTime)" ois-drag class="timetable-higher-drag" id="{{lessonTime.start}}-{{group.id}}" capacity-type="{{lessonTime.capacityType}}"
                  style="background-color: {{getColorByCode(lessonTime.subjectCode)}}" ng-if="lessonTime.colspan" old-event-id="{{lessonTime.id}}">
                  <span>{{lessonTime.subjectCode}}/{{getCapacityTypeValue(lessonTime.capacityType)}}</span>
                  <br><span style=";{{lessonTime.rooms ? '' : 'color:red;font-weight: bold;'}}">{{lessonTime.rooms ? getRoomCodes(lessonTime.rooms) : "?"}}</span>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </md-table-container>

    <md-button ng-href="#/timetable/{{timetableId}}/view" class="md-raised">{{'main.button.back' | translate}}</md-button>

  </div>
</div>
