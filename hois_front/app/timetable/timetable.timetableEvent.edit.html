
<div class="ois-form-layout-padding" ng-cloak>
  <div flex>
    <form name="eventForm" ng-submit="eventForm.$valid && loadData()" novalidate>
      <div layout="row" flex="100">
        <md-input-container flex="20" flex-md="100" flex-sm="100" flex-xs="100">
          <label>{{'main.date' | translate}}</label>
          <md-datepicker required ng-model="timetableEvent.date"></md-datepicker>
        </md-input-container>
        <md-input-container flex="20" flex-sm="100" flex-offset="2" flex-offset-xs="0" flex-offset-sm="0">
          <label>{{'main.start' | translate}}</label>
          <hois-time required ng-model="timetableEvent.startTime" placeholder="{{'main.timePlaceholder' | translate}}"></hois-time>
        </md-input-container>
        <md-input-container flex="20" flex-sm="100" flex-offset="2" flex-offset-xs="0" flex-offset-sm="0">
          <label>{{'main.end' | translate}}</label>
          <hois-time required ng-model="timetableEvent.endTime" placeholder="{{'main.timePlaceholder' | translate}}"></hois-time>
        </md-input-container>
      </div>
      <div layout="row" flex="100">
        <md-input-container flex="60" flex-sm="100" flex-xs="100">
          <label class="textInput">{{'timetable.timetableEvent.name' | translate}}</label>
          <input type="text" ng-model="timetableEvent.name" required md-maxlength="255">
        </md-input-container>
      </div>
      <div ng-if="!timetableEvent.id" layout="row" flex="100">
        <md-input-container flex="20" flex-sm="100" flex-xs="100">
          <md-checkbox ng-model="timetableEvent.repeat" aria-label="Is repeat event">
            {{'timetable.timetableEvent.isRepeat' | translate}}
          </md-checkbox>
        </md-input-container>
        <div ng-if="timetableEvent.repeat" flex="80">
          <md-input-container flex="50">
            <label>{{'timetable.timetableEvent.weekAmount' | translate}}</label>
            <input flex="100" ng-model="timetableEvent.weekAmount" type="number" autofocus aria-label="weekamount" required>
          </md-input-container>

          <md-input-container flex="50" flex-offset="5">
            <label>{{'timetable.timetableEvent.repetition' | translate}}</label>
            <hois-classifier-select flex="100" ng-model="timetableEvent.repeatCode" model-value-attr="code" aria-label="repeatcode" 
              filter-values="['TUNNIPLAAN_SYNDMUS_KORDUS_EI']" main-classifier-code="TUNNIPLAAN_SYNDMUS_KORDUS" required>
            </hois-classifier-select>
          </md-input-container>
        </div>
      </div>

      <div layout="row" flex="60" flex-sm="100" flex-xs="100">
        <hois-autocomplete label="timetable.timetableEvent.teacher" ng-model="timetableEvent.teacher" ng-disabled="auth.isTeacher()" method="teachers"
          additional-query-params="{valid: true, occupied: true, date: timetableEvent.date, startTime: timetableEvent.startTime, endTime: timetableEvent.endTime, 
            repeatCode: timetableEvent.repeatCode, weekAmount: timetableEvent.weekAmount}" flex></hois-autocomplete>
      </div>
      <div layout="column" class="common-label" flex="55" ng-repeat="teacher in timetableEvent.teachers">
        <div layout="row" flex layout-align="start center">
          <div flex="5">&nbsp;</div>
          <div flex="50">{{teacher.nameEt}}</div>
          <div ng-if="auth.isAdmin()">
            <a ng-click="deleteTeacher(teacher)" class="remove">&times;</a>
          </div>
        </div>
      </div>

      <div layout="row" flex="60" flex-sm="100" flex-xs="100">
        <hois-autocomplete label="timetable.timetableEvent.room" ng-model="timetableEvent.room" method="rooms"
          additional-query-params="{isStudy: true, occupied: true, date: timetableEvent.date, startTime: timetableEvent.startTime, endTime: timetableEvent.endTime, 
            repeatCode: timetableEvent.repeatCode, weekAmount: timetableEvent.weekAmount}" flex></hois-autocomplete>
      </div>
      <div layout="column" class="common-label" flex="55" ng-repeat="room in timetableEvent.rooms | orderBy: currentLanguageNameField()">
        <div layout="row" flex layout-align="start center">
          <div flex="5">&nbsp;</div>
          <div flex="50">{{room.nameEt}}</div>
          <div>
            <a ng-click="deleteRoom(room)" class="remove">&times;</a>
          </div>
        </div>
      </div>

      <div layout="row" flex="60" flex-sm="100" flex-xs="100">
        <hois-autocomplete label="timetable.timetableEvent.studentGroup" ng-model="timetableEvent.studentGroup" method="studentgroups"
          additional-query-params="{valid: true, occupied: true, date: timetableEvent.date, startTime: timetableEvent.startTime, endTime: timetableEvent.endTime, 
            repeatCode: timetableEvent.repeatCode, weekAmount: timetableEvent.weekAmount, studentGroupTeacherId: auth.isTeacher() ? auth.teacher : undefined}" 
          flex></hois-autocomplete>
      </div>
      <div layout="column" class="common-label" flex="55" ng-repeat="studentGroup in timetableEvent.studentGroups">
        <div layout="row" flex layout-align="start center">
          <div flex="5">&nbsp;</div>
          <div flex="50">{{studentGroup.nameEt}}</div>
          <div>
            <a ng-click="deleteStudentGroup(studentGroup)" class="remove">&times;</a>
          </div>
        </div>
      </div>

      <div layout="row" flex="100">
        <md-input-container flex="60" flex-sm="100" flex-xs="100">
          <label class="textInput">{{'timetable.timetableEvent.otherTeacher' | translate}}</label>
          <input type="text" ng-model="timetableEvent.otherTeacher" md-maxlength="1000">
        </md-input-container>
      </div>
      <div layout="row" flex="100">
        <md-input-container flex="60" flex-sm="100" flex-xs="100">
          <label class="textInput">{{'timetable.timetableEvent.otherRoom' | translate}}</label>
          <input type="text" ng-model="timetableEvent.otherRoom" md-maxlength="1000">
        </md-input-container>
      </div>

      <div layout="row" flex="100">
        <md-button class="md-raised md-primary" ng-click="save()">{{'main.button.save' | translate}}</md-button>
        <md-button ng-if="timetableEvent.id" ng-click="delete()" class="md-raised">{{'main.button.delete' | translate}}</md-button>
        <md-button ng-click="back('#/lessonplans/events', eventForm)" class="md-raised">{{'main.button.back' | translate}}</md-button>
      </div>
    </form>
  </div>
</div>
