<div class="ois-form-layout" layout="column" layout-margin ng-hide="initializing" ng-cloak>

  <form name="vocationalCurriculumModuleImplementationPlanForm" layout="column">
    <md-input-container flex>
      <label>{{'module.implementationPlan.codeOrName' | translate}}</label>
      <input ng-model="implementationPlan.code" name="code" ng-model-options="{ debounce: 250 }" unique='codeUniqueQuery' type="text" md-maxlength="255" required>
        <div ng-messages="vocationalCurriculumModuleImplementationPlanForm.code.$error" ng-show="vocationalCurriculumModuleImplementationPlanForm.code.$dirty">
            <div ng-message="notUnique">
                {{'main.messages.error.mustBeUnique' | translate}}
            </div>
        </div>
    </md-input-container>

    <md-input-container flex>
      <label>{{'module.implementationPlan.targetGroup' | translate}}</label>
      <input ng-model="implementationPlan.targetGroup" type="text" md-maxlength="1000" required>
    </md-input-container>

    <md-input-container flex>
      <label>{{'module.implementationPlan.teachers' | translate}}</label>
      <input ng-model="implementationPlan.teachers" type="text" md-maxlength="1000" required>
    </md-input-container>

    <md-input-container flex>
      <label>{{'module.implementationPlan.teachingDepartment' | translate}}</label>
      <hois-school-department-select ng-model="implementationPlan.schoolDepartment" required></hois-school-department-select>
    </md-input-container>

    <div layout="row" layout-xs="column">
        <md-input-container flex="20" flex-xs="100">
          <label>{{'module.implementationPlan.studyForm' | translate}}</label>
          <hois-classifier-select ng-model="implementationPlan.curriculumStudyForm" show-only-values="curriculumStudyForms"
          model-value-attr="code" main-classifier-code="OPPEVORM" required></hois-classifier-select>
        </md-input-container>

        <md-input-container flex-xs="100">
          <div layout="row" layout-align="end" flex>
            <md-checkbox ng-model="implementationPlan.individual" aria-label="individual">{{'module.implementationPlan.individualCurriculum' | translate}}</md-checkbox>
          </div>
        </md-input-container>
    </div>


    <div layout-padding>
      <div layout="row" hide-sm>
        <div class="md-title" flex="70">
          {{'module.modules' | translate}}
        </div>
        <div class="md-title" flex>
          {{'main.inOrder' | translate}}
        </div>
      </div>

      <div ng-repeat="(moduleTypeCode, moduleTypeModules) in modulesWithOutOccupation track by moduleTypeCode">
        <div>
          <span class="md-title" style="margin-left:1em;">{{moduleTypeModules.moduleType[currentLanguageNameField()]}}</span>
        </div>
        <div layout="column">
          <div layout="row" ng-repeat="module in moduleTypeModules.modules track by $index" layout-sm="column" layout-align-sm="start start" layout-align="start center" flex>
            <div flex="30">
              <md-button style="margin-left:2em;" class="md-primary" ng-click="openViewModuleDialog(module)">
                {{module[currentLanguageNameField()]}}
              </md-button>
            </div>
            <div flex="10">
              {{module.credits}} EKAP
            </div>
            <div flex="30">
              <md-button class="md-primary" ng-click="openAddModuleDataDialog(module)">
                {{isOccupationModuleDataSaved(module) ? 'module.implementationPlan.viewUpdateModuleData' : 'module.implementationPlan.insertModuleData' | translate}}
              </md-button>
            </div>
            <div flex="10">
              {{isOccupationModuleDataSaved(module) ? 'main.yes' : 'main.no' | translate}}
            </div>
          </div>
        </div>
      </div>
    </div>

      <div ng-repeat="(occupationCode, occupationModuleTypes) in occupationModuleTypesModules track by occupationCode ">
        <div layout="column" flex>
            <div>
              <div class="md-headline">{{occupationModuleTypes.occupation[currentLanguageNameField()]}}</div>
            </div>
            <div layout="column">
              <div ng-repeat="(moduleTypeCode, moduleTypeModules) in occupationModuleTypes.moduleTypes track by moduleTypeCode">
                <div>
                  <span class="md-title" style="margin-left:1em;">{{moduleTypeModules.moduleType[currentLanguageNameField()]}}</span>
                </div>
                <div layout="column">
                  <div ng-repeat="module in moduleTypeModules.modules track by $index">
                    <div layout="row" layout-sm="column" layout-align-sm="start start" layout-align="start center" flex>
                      <div flex="30">
                        <md-button class="md-primary" style="margin-left:2em;" ng-click="openViewModuleDialog(module)">
                          {{module[currentLanguageNameField()]}} <!--({{module['objectives'+currentLanguage()[0].toUpperCase()+currentLanguage().slice(1)]}})-->
                        </md-button>
                      </div>
                      <div flex="10">
                        {{module.credits}} EKAP
                      </div>
                      <div flex="30">
                        <md-button class="md-primary" ng-click="openAddModuleDataDialog(module)">
                          {{isOccupationModuleDataSaved(module) ? 'module.implementationPlan.viewUpdateModuleData' : 'module.implementationPlan.insertModuleData' | translate}}
                          </md-button>
                      </div>
                      <div flex="10">
                        {{isOccupationModuleDataSaved(module) ? 'main.yes' : 'main.no' | translate}}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
        </div>
      </div>


    <div style="padding-bottom:2em;"></div>


    <div layout="row" layout-xs="column">
      <md-input-container flex="20">
        <label>{{'main.validityPeriod' | translate}}</label>
      </md-input-container>
      <md-input-container>
        <label>{{'main.validFrom' | translate}}</label>
        <md-datepicker ng-model="implementationPlan.validFrom" md-open-on-focus required></md-datepicker>
      </md-input-container>

      <md-input-container>
        <label>{{'main.validTo' | translate}}</label>
        <md-datepicker ng-model="implementationPlan.validThru" md-min-date="implementationPlan.validFrom" md-open-on-focus></md-datepicker>
      </md-input-container>
    </div>

    <md-input-container flex>
      <label>{{'main.notes' | translate}}</label>
      <textarea ng-model="implementationPlan.description" md-maxlength="20000" max-rows="2" md-select-on-focus></textarea>
    </md-input-container>

    <div layout="row" layout-xs="column">
      <md-input-container flex>
        <label>{{'module.implementationPlan.admissionYear' | translate}}</label>
        <md-select ng-model="implementationPlan.admissionYear">
          <md-option ng-repeat="year in ::admissionYears" ng-value="year" aria-label="{{year}}">{{year}}</md-option>
        </md-select>
      </md-input-container>

      <md-input-container flex>
        <label>{{'module.implementationPlan.type' | translate}}</label>
        <hois-classifier-select ng-model="implementationPlan.type" model-value-attr="code" main-classifier-code="OPPEKAVA_VERSIOON_LIIK" required ></hois-classifier-select>
      </md-input-container>
    </div>

    <div layout="row">
      <md-input-container flex="15" flex-sm="100">
        <span class="label">{{'main.status' | translate}}</span>
      </md-input-container>
      <md-input-container flex="15" flex-sm="100">
        <hois-classifier-value ng-model="implementationPlan.status"  main-classifier-code="OPPEKAVA_VERSIOON_STAATUS"></hois-classifier-value>
      </md-input-container>
      <md-input-container>
        <a href="" ng-show="implementationPlan.id > 0 && implementationPlan.status.code === 'OPPEKAVA_VERSIOON_STAATUS_M'" ng-click="implementationPlan.status = {code: 'OPPEKAVA_VERSIOON_STAATUS_K'}" class="md-primary">{{'main.button.status.confirm' | translate}}</a>
        <a href="" ng-show="implementationPlan.id > 0 && implementationPlan.status.code === 'OPPEKAVA_VERSIOON_STAATUS_S'" ng-click="implementationPlan.status = {code: 'OPPEKAVA_VERSIOON_STAATUS_M'}" class="md-primary">{{'main.button.status.approving' | translate}}</a>
        <a href="" ng-hide="!(implementationPlan.id > 0) || implementationPlan.status.code === 'OPPEKAVA_VERSIOON_STAATUS_C'" ng-click="implementationPlan.status = {code: 'OPPEKAVA_VERSIOON_STAATUS_C'}" class="md-primary">{{'main.button.status.close' | translate}}</a>
      </md-input-container>
    </div>

    <div layout="column">
      <span class="md-headline">{{'curriculum.informativeSection' | translate}}</span>
    </div>

    <hois-created-modified object="implementationPlan"></hois-created-modified>
  </form>


  <div layout="row">
    <md-button class="md-raised md-primary" ng-click="save()">{{'main.button.save' | translate}}</md-button>
    <md-button class="md-raised md-default" ng-href="/#/vocationalCurriculum/{{curriculumId}}/edit">{{'main.button.back' | translate}}</md-button>
    <md-button ng-if="implementationPlan.id" class="md-raised md-default" ng-click="copy()">{{'main.button.copy' | translate}}</md-button>
  </div>
</div>
