<div layout="column" layout-padding>
    <form name="messageNewForm">
        <div layout="column">

            <md-input-container flex="50" flex-sm="100" flex-xs="100">
                <label class="textInput">{{'message.subject' | translate}}</label>
                <input ng-model="record.subject" type="text" md-maxlength="1000" required>
            </md-input-container>
            <md-input-container flex="50" flex-sm="100" flex-xs="100">
                <label class="textInput">{{'message.content' | translate}}</label>
                <textarea ng-model="record.content" max-rows="20" md-maxlength="2000" required></textarea>
            </md-input-container>

            <md-input-container flex="50" flex-sm="100" flex-xs="100">
                <label>{{'message.targetGroup' | translate}}</label>
                <hois-classifier-select ng-model="targetGroup" model-value-attr="code" main-classifier-code="ROLL" show-only-values="targetGroups"></hois-classifier-select>
            </md-input-container>

            <md-autocomplete
                name="receiverInput"
                md-selected-item="receiver"
                md-search-text="queryText"
                md-items="item in querySearch(queryText)"
                md-item-text="item.name"
                md-min-length="0"
                placeholder="{{'message.receiver' | translate}}"
                ng-model="queryText"
                md-no-cache
				class="small-margin"
                md-selected-item-change="addReceiver(receiver)"
                >

              <md-item-template>
                <span md-highlight-text="queryText" md-highlight-flags="^i">{{item.name}}</span>
              </md-item-template>

              <md-not-found>
                {{'main.messages.error.notFound' | translate}}
              </md-not-found>

            </md-autocomplete>

            <md-input-container flex="50" flex-sm="100" flex-xs="100">
                <label>{{'message.curriculumStudents' | translate}}</label>
                <hois-select multiple ng-model="curriculum" type="curriculum"></hois-select>
            </md-input-container>

            <md-input-container flex="50" flex-sm="100" flex-xs="100">
                <label>{{'message.studyGroupStudents' | translate}}</label>
                <hois-select multiple ng-model="studentGroup"  type="studentgroups"></hois-select>
            </md-input-container>

            <md-input-container flex="50" flex-sm="100" flex-xs="100">
                <label>{{'message.studyFormStudents' | translate}}</label>
                <hois-classifier-select multiple ng-model="studyForm" model-value-attr="code" main-classifier-code="OPPEVORM"></hois-classifier-select>
            </md-input-container>

            <h2 ng-class="{invalid: messageNewForm.$submitted && receivers.length === 0}">{{'message.messageReceiver' | translate}} *</h2>

            <table md-table class="secondary-table">
                <thead md-head>
                    <tr md-row>
                        <th md-column>{{'message.receiver' | translate}}</th>
                        <th md-column>{{'student.idcode' | translate}}</th>
                        <th md-column>{{'message.targetGroup' | translate}}</th>
                        <th md-column></th>
                    </tr>
                </thead>
                <tbody md-body>
                <tr md-row ng-repeat="receiver in receivers" ng-class-odd="'odd'" ng-class-even="'even'">
                    <td md-cell>{{receiver.fullname}}</td>
                    <td md-cell>{{receiver.idcode}}</td>
                    <td md-cell>
                        <p ng-repeat="role in receiver.role">
                            <hois-classifier-value ng-model="role" main-classifier-code="ROLL"></hois-classifier-value>
                        </p>
                    </td>
                    <td md-cell><md-button class="remove nomargin" ng-click="removeReceiver(receiver)">&times;</md-button></td>
                </tr>
                </tbody>
            </table>
        </div>
        <div layout="row">
            <md-button class="md-raised md-primary" ng-click="send()">{{'main.button.send' | translate}}</md-button>
            <md-button class="md-raised" ng-href="{{::formState.backUrl}}">{{'main.button.back' | translate}}</md-button>
        </div>
    </form>
</div>
